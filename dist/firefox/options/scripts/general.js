import browser from"webextension-polyfill";import{STORAGE_KEYS}from"../../config.js";const{ENABLED,BLOCKED_SITES,FILTER_MODE,PROCEED_TEXT,CONFIRM_TEXT,CONFIRM_MODE}=STORAGE_KEYS;let enabledCheckbox,filterModeCheckbox,confirmModeCheckbox,proceedTextInput,confirmTextInput,saveButton,statusDiv,loadedSettings=null;export function init(){console.log("General initialising"),enabledCheckbox=document.getElementById("globalEnabled"),filterModeCheckbox=document.getElementById("filterMode"),confirmModeCheckbox=document.getElementById("confirmMode"),proceedTextInput=document.getElementById("proceedText"),confirmTextInput=document.getElementById("confirmText"),saveButton=document.getElementById("save-button"),statusDiv=document.getElementById("status"),loadSettings(),saveButton.addEventListener("click",saveSettings),enabledCheckbox.addEventListener("change",toggleConfirmationSettings),filterModeCheckbox.addEventListener("change",toggleConfirmationSettings)}export function cleanup(){console.log("General cleaning up"),saveButton?.removeEventListener("click",saveSettings),enabledCheckbox?.removeEventListener("change",toggleConfirmationSettings),filterModeCheckbox?.removeEventListener("change",toggleConfirmationSettings)}const loadSettings=()=>{browser.storage.sync.get(Object.values(STORAGE_KEYS)).then(e=>{loadedSettings=e,console.log("General loading settings: ",e),enabledCheckbox.checked=e[ENABLED]??!0,filterModeCheckbox.checked=e[FILTER_MODE]??!0,confirmModeCheckbox.checked=e[CONFIRM_MODE]??!0,proceedTextInput.value=e[PROCEED_TEXT]??"I'm sure I want to use AI.",confirmTextInput.value=e[CONFIRM_TEXT]??"Confirm",toggleConfirmationSettings()}).catch(e=>{console.error("Error loading settings:",e),statusDiv.textContent="Error loading settings.",statusDiv.style.color="red"})},saveSettings=()=>{const e=enabledCheckbox.checked,t=filterModeCheckbox.checked,o=proceedTextInput.value.trim(),n=confirmTextInput.value.trim(),i=confirmModeCheckbox.checked,s={[ENABLED]:e,[BLOCKED_SITES]:loadedSettings[BLOCKED_SITES],[FILTER_MODE]:t,[PROCEED_TEXT]:o,[CONFIRM_TEXT]:n,[CONFIRM_MODE]:i};console.log("Saving settings:",s),browser.storage.sync.set(s).then(()=>{statusDiv.textContent="Settings saved!",statusDiv.style.color="var(--emerald)",setTimeout(()=>{status.textContent=""},3e3)}).catch(e=>{console.error("Error saving settings:",e),statusDiv.textContent="Error saving settings.",statusDiv.style.color="var(--rose)"})},toggleConfirmationSettings=()=>{const e=enabledCheckbox.checked,t=e&&filterModeCheckbox.checked;filterModeCheckbox.disabled=!e,proceedTextInput.disabled=!e,confirmModeCheckbox.disabled=!t,confirmTextInput.disabled=!t};